<% content_for :map do %>
  <%= gmaps(
          :map_options => {
              :center_latitude => 41.637255074888465,
              :center_longitude => 21.741941953124297,
              :detect_location => false,
              :center_on_user => false,
              :auto_adjust => false,
              :auto_zoom => true,
              :zoom => 8,
              :type => 'ROADMAP',
              :raw => "{zoomControl: false, panControl: false, streetViewControl: false, mapTypeControl: false,
            styles: styles}"
          },
          :markers => {
              :data => @json
          }
      ) %>
<% end %>
<% if user_signed_in? %>
  <div class="span12">
    <table class="table table-striped">
      <tr>
        <th><%= UserProfile.human_attribute_name("logo") %></th>
        <th><%= User.model_name.human %></th>
        <th><%= NewsPost.human_attribute_name("title") %></th>
        <th><%= NewsPost.human_attribute_name("short_description") %></th>
        <th></th>
        <th></th>
        <th></th>
      </tr>

      <% NewsPost.order("created_at DESC").limit(3).each do |news_post| %>
        <tr>
          <td><%= image_tag news_post.user.user_profile.logo_url(:thumb).to_s %></td>
          <td><%= news_post.user.user_profile.name %></td>
          <td><%= news_post.title %></td>
          <td><%= news_post.short_description %></td>
          <td>
            <% if can? :read, news_post %>
              <%= link_to 'Show', news_post %>&nbsp;
            <% end %>
          </td>
          <td>
            <% if can? :edit, news_post %>
              <%= link_to 'Edit', edit_news_post_path(news_post) %>&nbsp;
            <% end %>
          </td>
          <td>
            <% if can? :destroy, news_post %>
              <%= link_to 'Destroy', news_post, :method => :delete, :data => {:confirm => 'Are you sure?'} %>&nbsp;
            <% end %>
          </td>
        </tr>
      <% end %>
    </table>

    <% if can? :create, NewsPost %>
      <br/>
      <%= link_to 'New News post', new_news_post_path %>
    <% end %>

  </div>

<% else %>
  <div class="span6">
    <h4>Постоечки корисник?</h4>
    <%= minimal_nested_form_for(resource, :as => resource_name, :url => session_path(resource_name), :html => {:class => 'form-vertical' }) do |f| %>
      <%= f.input :email, :autofocus => true, :placeholder => 'имејл' %>
      <%= f.input :password, :placeholder => 'лозинка' %>
      <%= f.input_field :remember_me, :inline_label => 'зачувај', :as => :boolean if devise_mapping.rememberable? %>
      <br>
      <%= f.button :submit, "најави ме", :class => 'btn-primary' %>
    <% end %>
    <%= render "users/shared/links" %>
  </div>
  <div class="span6">
    <h4>
      Нов корисник?<br>
      За регистрација кликнете <%= link_to('тука', new_user_registration_path)  %>
    </h4>
  </div>
<% end %><%= content_for :scripts do %>
  <script type="text/javascript" charset="utf-8">
    Gmaps.map.callback = function() {
      google.maps.event.addDomListener(window, "resize", function() {
        var map = Gmaps.map.serviceObject;
        var center = map.getCenter();
        google.maps.event.trigger(map, 'resize');
        map.setCenter(center);
      });
    }
  </script>
<% end %>