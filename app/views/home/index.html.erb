<% content_for :map do %>
  <%= gmaps(
          :map_options => {
              :center_latitude => 41.637255074888465,
              :center_longitude => 21.741941953124297,
              :detect_location => false,
              :center_on_user => false,
              :auto_adjust => false,
              :auto_zoom => true,
              :zoom => 8,
              :type => 'ROADMAP',
              :raw => "{zoomControl: false, panControl: false, streetViewControl: false, mapTypeControl: false,
            styles: styles}"
          },
          :markers => {
              :data => @json
          }
      ) %>
<% end %>
<% if user_signed_in? %>
  <div class="span12">
    <table class="table table-striped">
      <tr>
        <th><%= UserProfile.human_attribute_name('logo') %></th>
        <th><%= User.model_name.human %></th>
        <th><%= NewsPost.human_attribute_name('title') %></th>
        <th><%= NewsPost.human_attribute_name('short_description') %></th>
        <th></th>
        <th></th>
        <th></th>
      </tr>

      <% NewsPost.order('created_at DESC').limit(3).each do |news_post| %>
        <tr>
          <td><%= image_tag news_post.user.user_profile.logo_url(:thumb).to_s %></td>
          <td><%= news_post.user.user_profile.name %></td>
          <td><%= news_post.title %></td>
          <td><%= news_post.short_description %></td>
          <td>
            <% if can? :read, news_post %>
              <%= link_to "#{t('action.show')}", news_post %>&nbsp;
            <% end %>
          </td>
          <td>
            <% if can? :edit, news_post %>
              <%= link_to "#{t('action.edit')}", edit_news_post_path(news_post) %>&nbsp;
            <% end %>
          </td>
          <td>
            <% if can? :destroy, news_post %>
              <%= link_to "#{t('action.destroy')}", news_post, :method => :delete, :data => {:confirm => "#{t('alert.are_you_sure')}"} %>&nbsp;
            <% end %>
          </td>
        </tr>
      <% end %>
    </table>

    <% if can? :create, NewsPost %>
      <br/>
      <%= link_to "#{t(:new, :gender => :f)} #{NewsPost.model_name.human}", new_news_post_path %>
    <% end %>

  </div>

<% else %>
  <div class="span6">
    <h4><%= t('home.login_title') %></h4>
    <%= minimal_nested_form_for(resource, :as => resource_name, :url => session_path(resource_name), :html => {:class => 'form-vertical' }) do |f| %>
      <%= f.input :email, :autofocus => true, :placeholder => User.human_attribute_name('email') %>
      <%= f.input :password, :placeholder => User.human_attribute_name('password') %>
      <%= f.input_field :remember_me, :inline_label => User.human_attribute_name('remember_me'),
                        :as => :boolean if devise_mapping.rememberable? %>
      <br>
      <%= f.button :submit, t('action.log_me_in'), :class => 'btn-primary' %>
    <% end %>
    <%= render "users/shared/links" %>
  </div>
  <div class="span6">
    <h4>
      <%= t('home.sign_up_title') %><br>
      <%= t('home.sign_up_subtitle') %> <%= link_to(t('home.here'), new_user_registration_path)  %>
    </h4>
  </div>
<% end %><%= content_for :scripts do %>
  <script type="text/javascript" charset="utf-8">
    Gmaps.map.callback = function() {
      google.maps.event.addDomListener(window, "resize", function() {
        var map = Gmaps.map.serviceObject;
        var center = map.getCenter();
        google.maps.event.trigger(map, 'resize');
        map.setCenter(center);
      });
    }
  </script>
<% end %>