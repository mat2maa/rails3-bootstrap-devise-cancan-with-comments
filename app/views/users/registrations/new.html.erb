<% content_for :map do %>
  <%= gmaps(
          map_options: {
              center_latitude: 41.637255074888465,
              center_longitude: 21.741941953124297,
              detect_location: false,
              center_on_user: false,
              auto_adjust: false,
              auto_zoom: true,
              zoom: 8,
              type: 'ROADMAP',
              raw: '{zoomControl: false, panControl: false, streetViewControl: false, mapTypeControl: false,
            styles: styles}'
          },
          markers: {
              data: @json
          }
      ) %>
<% end %>
<%= content_for :scripts do %>
  <script type="text/javascript" charset="utf-8">
    Gmaps.map.callback = function() {
      google.maps.event.addDomListener(window, "resize", function() {
        var map = Gmaps.map.serviceObject;
        var center = map.getCenter();
        google.maps.event.trigger(map, 'resize');
        map.setCenter(center);
      });
    }
  </script>
<% end %>

<%= minimal_nested_form_for [resource_name, resource.with_user_profile],
                            url: registration_path(resource_name),
                            html: {class: 'form-vertical'} do |f| %>
  <div class="span6">
    <h4>1. Fill in your login details</h4>
    <hr>
    <%= devise_error_messages! %>
    <%= f.error_notification %>
    <%= display_base_errors resource %>
    <%= f.input :email,
                placeholder: 'Email',
                required: true %>
    <p>Password must be a minimum of 6 characters</p>
    <%= f.input :password,
                placeholder: 'Password',
                required: true %>
    <%= f.input :password_confirmation,
                placeholder: 'Password confirmation',
                required: true %>
  </div>
  <div class="span6">
    <h4>2. Choose your profile type</h4>
    <hr>
    <ul class="nav nav-pills nav-stacked" id="profile-type-select">
      <li data-type="ngo">
        <a href="#">NGO</a>
      </li>
      <li data-type="expert">
        <a href="#">Expert</a>
      </li>
      <li data-type="institution">
        <a href="#">Institution</a>
      </li>
      <li data-type="media">
        <a href="#">Media</a>
      </li>
    </ul>
  </div>
  <div class="span12 dynamic-form" style="display:none;">
    <h4>3. Give us some specifics</h4>
    <hr>
    <div class="form-inputs dynamic-form-inputs">
      <%= f.simple_fields_for :user_profile do |builder| %>
        <%= render 'user_profile_fields',
                   f: builder %>
      <% end %>
    </div>

    <div class="form-actions">
      <%= f.button :submit,
                   'Sign up',
                   class: 'btn-primary' %>
    </div>
<% end %>
</div>
